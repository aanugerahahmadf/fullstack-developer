(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78716,e=>{"use strict";let t=(0,e.i(75254).default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);e.s(["Video",()=>t],78716)},67585,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let s=e.r(32061);function r({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new s.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,l)=>{"use strict";function s(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"encodeURIPath",{enumerable:!0,get:function(){return s}})},52157,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"PreloadChunks",{enumerable:!0,get:function(){return i}});let s=e.r(43476),r=e.r(74080),n=e.r(63599),a=e.r(9885);function i({moduleIds:e}){if("undefined"!=typeof window)return null;let t=n.workAsyncStorage.getStore();if(void 0===t)return null;let l=[];if(t.reactLoadableManifest&&e){let s=t.reactLoadableManifest;for(let t of e){if(!s[t])continue;let e=s[t].files;l.push(...e)}}return 0===l.length?null:(0,s.jsx)(s.Fragment,{children:l.map(e=>{let l=`${t.assetPrefix}/_next/${(0,a.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,s.jsx)("link",{precedence:"dynamic",href:l,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,r.preload)(l,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return d}});let s=e.r(43476),r=e.r(71645),n=e.r(67585),a=e.r(52157);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},l=(0,r.lazy)(()=>t.loader().then(i)),d=t.loading;function c(e){let i=d?(0,s.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,c=o?r.Suspense:r.Fragment,u=t.ssr?(0,s.jsxs)(s.Fragment,{children:["undefined"==typeof window?(0,s.jsx)(a.PreloadChunks,{moduleIds:t.modules}):null,(0,s.jsx)(l,{...e})]}):(0,s.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(l,{...e})});return(0,s.jsx)(c,{...o?{fallback:i}:{},children:u})}return c.displayName="LoadableComponent",c}},70703,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return r}});let s=e.r(55682)._(e.r(69093));function r(e,t){let l={};"function"==typeof e&&(l.loader=e);let r={...l,...t};return(0,s.default)({...r,modules:r.loadableGenerated?.modules})}("function"==typeof l.default||"object"==typeof l.default&&null!==l.default)&&void 0===l.default.__esModule&&(Object.defineProperty(l.default,"__esModule",{value:!0}),Object.assign(l.default,l),t.exports=l.default)},50704,e=>{"use strict";var t=e.i(43476),l=e.i(71645),s=e.i(70703),r=e.i(78716),n=e.i(37727);let a=(0,e.i(75254).default)("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);var i=e.i(54858);let o=(0,s.default)(()=>e.A(52169).then(e=>e.MapContainer),{loadableGenerated:{modules:[94970]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-950/30 to-slate-900/30 flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-white/50 font-semibold",children:"Loading map..."})})}),d=(0,s.default)(()=>e.A(52169).then(e=>e.TileLayer),{loadableGenerated:{modules:[94970]},ssr:!1}),c=(0,s.default)(()=>e.A(52169).then(e=>e.Marker),{loadableGenerated:{modules:[94970]},ssr:!1}),u=(0,s.default)(()=>e.A(52169).then(e=>e.Popup),{loadableGenerated:{modules:[94970]},ssr:!1});function m(){let[s,m]=(0,l.useState)([]),[h,x]=(0,l.useState)(null),[f,p]=(0,l.useState)(!1),[b,j]=(0,l.useState)(null),[g,w]=(0,l.useState)(!0),[y,v]=(0,l.useState)(!1),N=(0,l.useRef)(null),k=(0,l.useRef)(null);(0,l.useEffect)(()=>{v(!0),P(),e.A(71400).then(e=>{k.current=e})},[]);let P=async()=>{try{let e=await i.api.getBuildings();m(e)}catch(e){console.error("Failed to fetch buildings:",e)}finally{w(!1)}},C=async e=>{try{x(e),p(!0);let t=await i.api.getCctvStreamUrl(e.id);j(t)}catch(e){console.error("Failed to fetch stream URL:",e)}};return(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(p(!1),j(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,t.jsxs)("main",{className:"bg-gradient-to-br from-blue-950 via-slate-900 to-blue-950 py-8 min-h-[calc(100vh-140px)] flex flex-col",children:[(0,t.jsx)("div",{className:"pt-4 pb-6 px-4",children:(0,t.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold text-white text-center",children:"Maps"})}),(0,t.jsx)("div",{className:"px-4 pb-6 flex-grow flex justify-center",children:(0,t.jsx)("div",{className:"h-[50vh] sm:h-[60vh] md:h-[70vh] w-full max-w-4xl rounded-2xl overflow-hidden shadow-2xl z-0",children:y&&!g?(0,t.jsxs)(o,{center:[-6.1751,108.2146],zoom:13,style:{height:"100%",width:"100%"},className:"z-0",ref:N,children:[(0,t.jsx)(d,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),s.map(e=>(0,t.jsx)(c,{position:[e.latitude,e.longitude],icon:((e,t=[32,32])=>{if(k.current)return new k.current.Icon({iconUrl:e,iconSize:t,iconAnchor:[t[0]/2,t[1]],popupAnchor:[0,-t[1]]})})(e.marker_icon_url||"https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-blue.png",[32,32]),children:(0,t.jsx)(u,{children:(0,t.jsxs)("div",{className:"p-2 max-w-xs",children:[(0,t.jsx)("h3",{className:"font-bold text-lg text-blue-600",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[e.rooms?.length||0," Room"]}),(0,t.jsx)("button",{onClick:()=>{N.current&&N.current.flyTo([e.latitude,e.longitude],15)},className:"mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold py-1 px-2 rounded",children:"Zoom In"}),(0,t.jsx)("div",{className:"mt-2 max-h-60 overflow-y-auto",children:e.rooms?.map(e=>(0,t.jsxs)("div",{className:"mb-2 p-2 border rounded",children:[(0,t.jsx)("h4",{className:"font-semibold text-green-600",children:e.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:[e.cctvs?.length||0," CCTV"]}),(0,t.jsx)("div",{className:"mt-1 grid grid-cols-1 gap-1",children:e.cctvs?.map(e=>(0,t.jsxs)("button",{onClick:()=>C(e),className:"w-full bg-red-600 hover:bg-red-700 text-white text-xs font-semibold py-1 px-2 rounded flex items-center justify-center gap-1",children:[(0,t.jsx)(r.Video,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"truncate",children:e.name})]},`cctv-${e.id}`))})]},`room-${e.id}`))})]})})},`building-${e.id}`))]}):(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-950/30 to-slate-900/30 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-3"}),(0,t.jsx)("p",{className:"text-white/50 font-semibold",children:"Loading map..."})]})})})}),f&&h&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-blue-950 border border-white/20 rounded-2xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 md:p-6 border-b border-white/10",children:[(0,t.jsxs)("h2",{className:"text-lg md:text-xl font-semibold text-white flex items-center gap-2",children:[(0,t.jsx)(r.Video,{className:"w-5 h-5 text-red-400"}),(0,t.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-xs",children:h.name})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{document.createElement("video").requestFullscreen()},className:"text-white/70 hover:text-white transition p-1","aria-label":"Full Screen",children:(0,t.jsx)(a,{className:"w-5 h-5"})}),(0,t.jsx)("button",{onClick:()=>{p(!1),j(null)},className:"text-white/70 hover:text-white transition p-1","aria-label":"Close",children:(0,t.jsx)(n.X,{className:"w-5 h-5"})})]})]}),(0,t.jsx)("div",{className:"aspect-video bg-black/50 flex items-center justify-center flex-grow relative",children:b?(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-black",children:(0,t.jsxs)("div",{className:"text-center p-4",children:[(0,t.jsx)(r.Video,{className:"w-16 h-16 text-white/30 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-white/50 font-semibold text-lg",children:"Live Stream Player"}),(0,t.jsx)("p",{className:"text-white/30 text-sm mt-2",children:"Stream connection established"}),(0,t.jsxs)("div",{className:"mt-6 text-xs text-white/40 space-y-1",children:[(0,t.jsxs)("p",{children:["Camera: ",h.name]}),(0,t.jsxs)("p",{children:["Location: ",h.room?.name," - ",h.room?.building?.name]})]})]})})}):(0,t.jsxs)("div",{className:"text-center p-4",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-3"}),(0,t.jsx)("p",{className:"text-white/50 font-semibold",children:"Loading stream..."})]})}),(0,t.jsx)("div",{className:"p-4 border-t border-white/10 flex justify-end gap-2",children:(0,t.jsx)("button",{onClick:()=>{p(!1),j(null)},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition",children:"Close"})})]})})]})}e.s(["default",()=>m],50704)},52169,e=>{e.v(t=>Promise.all(["static/chunks/983c3130c13fb657.js","static/chunks/1442f9ddf5556540.js"].map(t=>e.l(t))).then(()=>t(94970)))},71400,e=>{e.v(t=>Promise.all(["static/chunks/1442f9ddf5556540.js"].map(t=>e.l(t))).then(()=>t(32322)))}]);